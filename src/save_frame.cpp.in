#include "opencv2/opencv.hpp"
#include <iostream>
#include <ctime>
#include <thread>
#include <chrono>

#define ERROR_VIDEO_STREAM 1
#define ERROR_DUMP_FRAME   2

int main(int argc, char** argv)
{
  if (argc < 2) {
    std::cerr << "Usage : " << argv[0] << " path/or/url/to/video" << std::endl;
    exit(1);
  }

  cv::VideoCapture vcap(argv[1]);
  if (!vcap.isOpened()) {
    std::cout << "Error opening video stream or file" << std::endl;
    exit(ERROR_VIDEO_STREAM);
  }

  cv::Mat frame;
  std::string frame_name;
  int frame_cnt = 0;
  for (;;) {
    vcap >> frame;
    frame_name = "@IMAGE_FOLDER@/@PEOPLEBOX_ID@_" + std::to_string(std::time(0)) + ".jpg";
    if( imwrite(frame_name,frame) ) std::cout << "Frame " << frame_cnt++ << " dumped" << std::endl;
    else {
      std::cerr << "Unable to write frame" << std::endl;
      exit(ERROR_DUMP_FRAME);
    }
    std::this_thread::sleep_for(std::chrono::seconds(@IMAGE_DUMP_DT_SEC@));
  }
  vcap.release();

  return 0;
}
